后端代码结构

~~~markdown
src/main/java/com/example/demo
├── DemoApplication.java
│
├── config
│   ├── MyBatisPlusConfig.java           # MP 分页插件、MetaObjectHandler 等
│   ├── SecurityConfig.java              # 统一装配（引入两套 filter chain）
│   ├── ApiSecurityConfig.java           # /api/** 用户端：JWT 鉴权
│   ├── AdminSecurityConfig.java         # /admin/** 管理端：JWT + RBAC
│   ├── WebMvcConfig.java                # CORS、静态资源、拦截器（可选）
│   └── OpenApiConfig.java               # 可选：Swagger/Knife4j
│
├── common                               # “通用能力”目录（你明确要求）
│   ├── api
│   │   ├── ApiResponse.java             # 统一返回包装（可开关）
│   │   ├── PageResponse.java
│   │   ├── PageRequest.java             # page/size 统一请求体（可选）
│   │   └── ErrorCode.java               # 枚举错误码
│   ├── exception
│   │   ├── BizException.java
│   │   └── GlobalExceptionHandler.java
│   ├── util
│   │   ├── IdUtil.java
│   │   ├── JsonUtil.java
│   │   ├── IpUtil.java
│   │   ├── TimeUtil.java
│   │   └── HashUtil.java
│   ├── security
│   │   ├── jwt
│   │   │   ├── JwtService.java          # 生成/解析 token
│   │   │   ├── JwtAuthenticationFilter.java
│   │   │   ├── JwtTokenExtractor.java
│   │   │   └── JwtProperties.java
│   │   ├── principal
│   │   │   ├── UserPrincipal.java       # 用户端主体
│   │   │   └── AdminPrincipal.java      # 管理端主体
│   │   ├── rbac
│   │   │   ├── Permission.java
│   │   │   ├── PermissionEvaluatorImpl.java
│   │   │   └── SecurityExpressions.java # hasPerm("xxx") 等
│   │   └── handler
│   │       ├── RestAuthenticationEntryPoint.java  # 401 JSON
│   │       └── RestAccessDeniedHandler.java       # 403 JSON
│   ├── mybatis
│   │   ├── BaseEntity.java              # id/createdAt/updatedAt 等
│   │   ├── MetaObjectHandlerImpl.java   # 自动填充 create/update
│   │   └── MybatisXmlLocation.java      # 可选：统一 mapper-locations
│   ├── lock
│   │   └── LocalLockService.java        # 可选：本地锁/并发控制
│   ├── rate
│   │   └── RateLimitService.java        # 可选：限流（简版）
│   └── event
│       ├── CounterEventService.java     # 对应 common.counter_event
│       └── CounterEventType.java
│
├── integration                          # 外部依赖集成（你要接 AI API）
│   ├── ai
│   │   ├── AiClient.java                # 对外统一接口
│   │   ├── AiProperties.java
│   │   ├── OpenAiClientImpl.java        # 具体实现（可替换）
│   │   └── dto
│   │       ├── AiChatReq.java
│   │       └── AiChatResp.java
│   └── storage                          # 可选：OSS/MinIO
│       └── FileStorageClient.java
│
├── module                               # 按业务域拆（与你 database/ 分域对齐）
│   ├── auth
│   │   ├── controller
│   │   │   ├── ApiAuthController.java   # /api/auth/**
│   │   │   └── AdminAuthController.java # /admin/auth/**
│   │   ├── service
│   │   │   ├── AuthService.java
│   │   │   └── impl/AuthServiceImpl.java
│   │   ├── repository                   # 你要求的额外抽象层
│   │   │   ├── UserRepository.java
│   │   │   ├── EmailOtpRepository.java
│   │   │   ├── AuthSessionRepository.java
│   │   │   └── AuthLoginLogRepository.java
│   │   ├── dao                          # MyBatis-Plus Mapper（真正连库）
│   │   │   ├── UserDao.java
│   │   │   ├── EmailOtpDao.java
│   │   │   ├── AuthSessionDao.java
│   │   │   └── AuthLoginLogDao.java
│   │   ├── entity
│   │   │   ├── UserEntity.java
│   │   │   ├── EmailOtpEntity.java
│   │   │   ├── AuthSessionEntity.java
│   │   │   └── AuthLoginLogEntity.java
│   │   └── dto
│   │       ├── req
│   │       │   ├── RegisterReq.java
│   │       │   ├── LoginReq.java
│   │       │   ├── SendEmailOtpReq.java
│   │       │   └── ResetPasswordReq.java
│   │       └── resp
│   │           ├── LoginResp.java       # token, tokenType=Bearer
│   │           └── UserProfileResp.java
│   │
│   ├── relation
│   │   ├── controller
│   │   │   └── RelationController.java  # follow/block
│   │   ├── service
│   │   │   ├── RelationService.java
│   │   │   └── impl/RelationServiceImpl.java
│   │   ├── repository
│   │   │   ├── UserFollowRepository.java
│   │   │   └── UserBlockRepository.java
│   │   ├── dao
│   │   │   ├── UserFollowDao.java
│   │   │   └── UserBlockDao.java
│   │   ├── entity
│   │   │   ├── UserFollowEntity.java
│   │   │   └── UserBlockEntity.java
│   │   └── dto
│   │       ├── req/FollowReq.java
│   │       └── resp/FollowStateResp.java
│   │
│   ├── recommend
│   │   ├── controller
│   │   │   ├── RecommendController.java       # /api/recommend/**（白名单包含今日推荐）
│   │   │   └── AdminRecommendController.java  # /admin/recommend/**
│   │   ├── service
│   │   │   ├── RecommendService.java
│   │   │   └── impl/RecommendServiceImpl.java
│   │   ├── repository
│   │   │   ├── RecommendContentRepository.java
│   │   │   ├── DailyRecommendationRepository.java
│   │   │   └── DailyRecommendationItemRepository.java
│   │   ├── dao
│   │   │   ├── RecommendContentDao.java
│   │   │   ├── DailyRecommendationDao.java
│   │   │   └── DailyRecommendationItemDao.java
│   │   ├── entity
│   │   │   ├── RecommendContentEntity.java
│   │   │   ├── DailyRecommendationEntity.java
│   │   │   └── DailyRecommendationItemEntity.java
│   │   └── dto
│   │       ├── req/RecommendQueryReq.java
│   │       └── resp/DailyRecommendationResp.java
│   │
│   ├── community
│   │   ├── controller
│   │   │   ├── PostController.java      # /api/posts/**（白名单包含帖子列表/详情）
│   │   │   └── AdminPostController.java # /admin/posts/**
│   │   ├── service
│   │   │   ├── PostService.java
│   │   │   ├── CommentService.java
│   │   │   └── impl
│   │   │       ├── PostServiceImpl.java
│   │   │       └── CommentServiceImpl.java
│   │   ├── repository
│   │   │   ├── PostRepository.java
│   │   │   ├── PostImageRepository.java
│   │   │   ├── PostAudioRepository.java
│   │   │   ├── CommentRepository.java
│   │   │   ├── LikeActionRepository.java
│   │   │   └── PostFavoriteRepository.java
│   │   ├── dao
│   │   │   ├── PostDao.java
│   │   │   ├── PostImageDao.java
│   │   │   ├── PostAudioDao.java
│   │   │   ├── CommentDao.java
│   │   │   ├── LikeActionDao.java
│   │   │   └── PostFavoriteDao.java
│   │   ├── entity
│   │   │   ├── PostEntity.java
│   │   │   ├── PostImageEntity.java
│   │   │   ├── PostAudioEntity.java
│   │   │   ├── CommentEntity.java
│   │   │   ├── LikeActionEntity.java
│   │   │   └── PostFavoriteEntity.java
│   │   └── dto
│   │       ├── req
│   │       │   ├── PostCreateReq.java
│   │       │   ├── PostQueryReq.java
│   │       │   ├── CommentCreateReq.java
│   │       │   ├── LikeReq.java
│   │       │   └── FavoriteReq.java
│   │       └── resp
│   │           ├── PostResp.java
│   │           ├── PostDetailResp.java
│   │           └── CommentResp.java
│   │
│   ├── question
│   │   ├── controller
│   │   │   ├── DailyQuestionController.java     # /api/daily-question/**
│   │   │   └── AdminDailyQuestionController.java# /admin/daily-question/**
│   │   ├── service
│   │   │   ├── DailyQuestionService.java
│   │   │   └── impl/DailyQuestionServiceImpl.java
│   │   ├── repository
│   │   │   ├── DailyQuestionRepository.java
│   │   │   ├── DailyQuestionPickRepository.java
│   │   │   └── DailyQuestionAnswerRepository.java
│   │   ├── dao
│   │   │   ├── DailyQuestionDao.java
│   │   │   ├── DailyQuestionPickDao.java
│   │   │   └── DailyQuestionAnswerDao.java
│   │   ├── entity
│   │   │   ├── DailyQuestionEntity.java
│   │   │   ├── DailyQuestionPickEntity.java
│   │   │   └── DailyQuestionAnswerEntity.java
│   │   └── dto
│   │       ├── req/DailyQuestionAnswerReq.java
│   │       └── resp/DailyQuestionResp.java
│   │
│   ├── commondata                       # 避免与顶层 common 目录同名（标签/搜索/计数）
│   │   ├── controller
│   │   │   ├── TagController.java       # /api/tags/**
│   │   │   └── SearchController.java    # /api/search/**
│   │   ├── service
│   │   │   ├── TagService.java
│   │   │   ├── SearchService.java
│   │   │   └── impl
│   │   │       ├── TagServiceImpl.java
│   │   │       └── SearchServiceImpl.java
│   │   ├── repository
│   │   │   ├── TagRepository.java
│   │   │   ├── TagMapRepository.java
│   │   │   └── SearchDocumentRepository.java
│   │   ├── dao
│   │   │   ├── TagDao.java
│   │   │   ├── TagMapDao.java
│   │   │   └── SearchDocumentDao.java
│   │   ├── entity
│   │   │   ├── TagEntity.java
│   │   │   ├── TagMapEntity.java
│   │   │   └── SearchDocumentEntity.java
│   │   └── dto
│   │       ├── req/SearchReq.java
│   │       └── resp/SearchResp.java
│   │
│   └── admin
│       ├── controller
│       │   ├── AdminUserController.java         # /admin/users/**
│       │   ├── AdminRoleController.java         # /admin/roles/**
│       │   ├── AdminPermissionController.java   # /admin/permissions/**
│       │   └── AdminAuditLogController.java     # /admin/audit-logs/**
│       ├── service
│       │   ├── AdminUserService.java
│       │   ├── AdminRoleService.java
│       │   ├── AdminPermissionService.java
│       │   └── impl
│       │       ├── AdminUserServiceImpl.java
│       │       ├── AdminRoleServiceImpl.java
│       │       └── AdminPermissionServiceImpl.java
│       ├── repository
│       │   ├── AdminUserRepository.java
│       │   ├── AdminRoleRepository.java
│       │   ├── AdminPermissionRepository.java
│       │   ├── AdminUserRoleRepository.java
│       │   ├── AdminRolePermissionRepository.java
│       │   └── AdminAuditLogRepository.java
│       ├── dao
│       │   ├── AdminUserDao.java
│       │   ├── AdminRoleDao.java
│       │   ├── AdminPermissionDao.java
│       │   ├── AdminUserRoleDao.java
│       │   ├── AdminRolePermissionDao.java
│       │   └── AdminAuditLogDao.java
│       ├── entity
│       │   ├── AdminUserEntity.java
│       │   ├── AdminRoleEntity.java
│       │   ├── AdminPermissionEntity.java
│       │   ├── AdminUserRoleEntity.java
│       │   ├── AdminRolePermissionEntity.java
│       │   └── AdminAuditLogEntity.java
│       └── dto
│           ├── req
│           │   ├── AdminLoginReq.java
│           │   ├── AdminUserCreateReq.java
│           │   ├── AdminRoleCreateReq.java
│           │   └── GrantRolePermReq.java
│           └── resp
│               ├── AdminLoginResp.java
│               └── AdminUserResp.java
│
└── controller                           # 可选：若你坚持“扁平 controller”，可只放聚合入口
    └── HealthController.java

~~~

